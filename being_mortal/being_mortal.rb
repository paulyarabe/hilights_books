require 'pry'

book_notes = ["In the United States, 25 percent of all Medicare spending is for the 5 percent of patients who are in their final year of life, and most of that money goes for care in their last couple of months that is of little apparent benefit. The United States is often thought to be unusual in this regard, but it doesn’t appear to be. Data from elsewhere are more limited, but where they are available—for instance, from countries like the Netherlands and Switzerland—the results are similar.\\n\\nFebruary 9, 2019", "I stopped to talk with the critical care physician on duty, someone I’d known since college. “I’m running a warehouse for the dying,” she said bleakly. Of the ten patients in her unit, she said, only two were likely to leave the hospital for any length of time. More typical was an almost eighty-year-old woman at the end of her life, with irreversible congestive heart failure, who was in the ICU for the second time in three weeks, drugged to oblivion and tubed in most natural orifices as well as a few artificial ones.\\n\\nFebruary 9, 2019", "In 2008, the national Coping with Cancer project published a study showing that terminally ill cancer patients who were put on a mechanical ventilator, given electrical defibrillation or chest compressions, or admitted, near death, to intensive care had a substantially worse quality of life in their last week than those who received no such interventions. And, six months after their death, their caregivers were three times as likely to suffer major depression.\\n\\nFebruary 9, 2019", "The most promising was a Pfizer drug that targeted one of the mutations found in her cancer’s cells. Sara and her family instantly pinned their hopes on it. The drug was so new that it didn’t even have a name, just a number—PF0231006—and this made it all the more enticing. There were a few hovering issues, including the fact that the scientists didn’t yet know the safe dose. The drug was only in a Phase I trial—that is, a trial designed to determine the toxicity of a range of doses, not whether the drug worked. Furthermore, a test of the drug against her cancer cells in a petri dish showed no effect. But Marcoux thought that these were not decisive obstacles, just negatives. The critical problem was that the rules of the trial excluded Sara because of the pulmonary embolism she had developed that summer.\\n\\nFebruary 9, 2019", "I spoke to Susan Block, a palliative care specialist at my hospital who has had thousands of these difficult conversations and is a nationally recognized pioneer in training doctors and others in managing end-of-life issues with patients and their families. “You have to understand,” Block told me. “A family meeting is a procedure, and it requires no less skill than performing an operation.”\\n\\nFebruary 9, 2019", "“A large part of the task is helping people negotiate the overwhelming anxiety—anxiety about death, anxiety about suffering, anxiety about loved ones, anxiety about finances,” she explained. “There are many worries and real terrors.” No one conversation can address them all. Arriving at an acceptance of one’s mortality and a clear understanding of the limits and the possibilities of medicine is a process, not an epiphany. There is no single way to take people with terminal illness through the process, but there are some rules, according to Block. You sit down. You make time. You’re not determining whether they want treatment X versus Y. You’re trying to learn what’s most important to them under the circumstances—so that you can provide information and advice on the approach that gives them their best chance of achieving it. This process requires as much listening as talking. If you are talking more than half of the time, Block says, you’re talking too much.\\n\\nFebruary 9, 2019", "You don’t ask, “What do you want when you are dying?” You ask, “If time becomes short, what is most important to you?”\\n\\nFebruary 9, 2019", "A few days later, the patient returned to talk to the oncologist. “There should be something. There must be something,” he said. His father had shown him reports of cures on the Internet. He confided how badly his father was taking the news. No patient wants to cause his family pain. According to Block, about two-thirds of patients are willing to undergo therapies they don’t want if that is what their loved ones want.\\n\\nFebruary 9, 2019", "She told the father that he needed to understand: time with his son was limited, and the young man was going to need his father’s help getting through it. The oncologist noted wryly how much easier it would have been for her just to prescribe the chemotherapy. “But that meeting with the father was the turning point,” she said. The patient and the family opted for hospice. They had more than a month together before he died. Later, the father thanked the doctor. That last month, he said, the family simply focused on being together, and it proved to be the most meaningful time they’d ever spent.\\n\\nFebruary 9, 2019", "still unresolved argument about what the function of medicine really is—what, in other words, we should and should not be paying for doctors to do. The simple view is that medicine exists to fight death and disease, and that is, of course, its most basic task. Death is the enemy. But the enemy has superior forces. Eventually, it wins. And in a war that you cannot win, you don’t want a general who fights to the point of total annihilation. You don’t want Custer. You want Robert E. Lee, someone who knows how to fight for territory that can be won and how to surrender it when it can’t, someone who understands that the damage is greatest if all you do is battle to the bitter end. More often, these days, medicine seems to supply neither Custers nor Lees. We are increasingly the generals who march the soldiers onward, saying all the while, “You let me know when you want to stop.” All-out treatment, we tell the incurably ill, is a train you can get off at any time—just say when. But for most patients and their families we are asking too much. They remain riven by doubt and fear and desperation; some are deluded by a fantasy of what medical science can achieve. Our responsibility, in medicine, is to deal with human beings as they are. People die only once. They have no experience to draw on. They need doctors and nurses who are willing to have the hard discussions and say what they have seen\\n\\nFebruary 9, 2019", "Benzel had a way of looking at people that let them know he was really looking at them. He was several inches taller than my parents, but he made sure to sit at eye level. He turned his seat away from the computer and planted himself directly in front of them. He did not twitch or fidget or even react when my father talked. He had that midwesterner’s habit of waiting a beat after people have spoken before speaking himself, in order to see if they are really done. He had small, dark eyes set behind wire-rim glasses and a mouth hidden by the thick gray bristle of a Van Dyke beard. The only thing to hint at what he was thinking was the wrinkle of his glossy dome of a forehead. Eventually, he steered the conversation back to the central issue. The tumor was worrisome, but he now understood something about my father’s concerns. He believed my father had time to wait and see how quickly his symptoms changed. He could hold off surgery\\n\\nFebruary 9, 2019", "In the end, Benzel was also the one who proved right. As time passed, my father noticed no change in symptoms. He decided to put off the follow-up appointment. It was ultimately a year before he returned to see Benzel. A repeat MRI showed the tumor had enlarged. Yet physical examination found no diminishment in my dad’s strength, sensation, or mobility.\\n\\nFebruary 9, 2019", "third type of doctor-patient relationship, which they called “interpretive.” Here the doctor’s role is to help patients determine what they want. Interpretive doctors ask, “What is most important to you? What are your worries?” Then, when they know your answers, they tell you about the red pill and the blue pill and which one would most help you achieve your priorities. Experts have come to call this shared decision making. It seemed to us medical students a nice way to work with patients as physicians. But it seemed almost entirely theoretical. Certainly, to the larger medical community, the idea that most doctors would play this kind of role for patients seemed far-fetched at the time. (Surgeons? “Interpretive?” Ha!)\\n\\nFebruary 9, 2019", "But it’s the meaning behind the information that people are looking for more than the facts. The best way to convey meaning is to tell people what the information means to you yourself, he said. And he gave me three words to use to do that. “I am worried,” I told Douglass. The tumor was still there, I explained, and I was worried the blockage was likely to come back. They were such simple words, but it wasn’t hard to sense how much they communicated. I had given her the facts. But by including the fact that I was worried, I’d not only told her about the seriousness of the situation, I’d told her that I was on her side—I was pulling for her. The words also told her that, although I feared something serious, there remained uncertainties—possibilities for hope within the parameters nature had imposed. I let her and her family take in what I’d said. I don’t remember Douglass’s precise words when she spoke, but I remember that the weather in the room had changed. Clouds rolled in. She wanted more information. I asked her what she wanted to know.\\n\\nFebruary 9, 2019", "This was another practiced and deliberate question on my part. I felt foolish to still be learning how to talk to people at this stage of my career. But Arnold had also recommended a strategy palliative care physicians use when they have to talk about bad news with people—they “ask, tell, ask.” They ask what you want to hear, then they tell you, and then they ask what you understood. So I asked.\\n\\nFebruary 9, 2019", "She was starting to grasp that this is what the closing phase of a modern life often looks like—a mounting series of crises from which medicine can offer only brief and temporary rescue. She was experiencing what I have come to think of as the ODTAA syndrome: the syndrome of One Damn Thing After Another. It does not have a totally predictable path. The pauses between crises can vary. But after a certain point, the direction of travel becomes clear.\\n\\nFebruary 9, 2019", "I distinctly remember the feeling that a crisis was creeping up on us. He was becoming quadriplegic. “Is it time for surgery?” I asked him. “I don’t know,” he said. It was time, I realized, for our own hard conversation. “I’m worried,” I said. I recalled the list of questions Susan Block, the palliative medicine expert, had said mattered most and posed them to my father one by one. I asked him what his understanding was of what was happening to him. He understood what I understood. He was becoming paralyzed, he said. What were his fears if that should happen, I asked? He said he feared that he would become a burden on my mother and that he wouldn’t be able to take care of himself anymore. He couldn’t fathom what his life would become. My mother, tearing, said she would be there for him. She would be happy to take care of him. Already the shift had started. He was having her do more and more of the driving, and she arranged his medical appointments now.\\n\\nFebruary 9, 2019", "He also complied with the instructions not to attempt to get around without help. The hospice helped my parents hire a personal care aide to stay overnight and assist my father to the bathroom when he needed it. After that, he had no more falls, and we gradually realized how much each one had set him back. Every passing day without a fall allowed his back and neck spasms to reduce, his pain to become better controlled, and his strength to increase.\\n\\nFebruary 9, 2019", "Technological society has forgotten what scholars call the “dying role” and its importance to people as life approaches its end. People want to share memories, pass on wisdoms and keepsakes, settle relationships, establish their legacies, make peace with God, and ensure that those who are left behind will be okay. They want to end their stories on their own terms. This role is, observers argue, among life’s most important, for both the dying and those left behind. And if it is, the way we deny people this role, out of obtuseness and neglect, is cause for everlasting shame.\\n\\nFebruary 10, 2019", "we in medicine inflict deep gouges at the end of people’s lives and then stand oblivious to the harm done.\\n\\nFebruary 10, 2019", "During the first couple days of August, I received a series of garbled e-mails. “Dear Atuli whohirnd li9ke Sude,” began one. The last one said: Dear Atul sorry for scrambeled letth ter. i having problems. -With love Dad-\\n\\nFebruary 10, 2019", "We’ve been wrong about what our job is in medicine. We think our job is to ensure health and survival. But really it is larger than that. It is to enable well-being. And well-being is about the reasons one wishes to be alive.\\n\\nFebruary 10, 201"]


# for each highlight, get rid of the date.  Date range: May 17-21, 2017
notes_sans_dates = book_notes.map do |note|
  note.scan(/(?<=)(.*?)(?=\\n\\n)/).flatten.join
end

# get rid of the bookmarks
@book_highlights = notes_sans_dates.delete_if {|element| element==""}
@author = 'Atul Gawande'
@book_title = 'Being Mortal. Illness, Medicine, and What Matters in the End'
@url = 'https://www.amazon.com/Being-Mortal-Illness-Medicine-Matters/dp/1781253943/ref=sr_1_3?ie=UTF8&qid=1532884210&sr=8-3&keywords=being+mortal&dpID=41-IAdR0cfL&preST=_SY344_BO1,204,203,200_QL70_&dpSrc=srch'

def show_all
  @book_highlights.map do |highlight|
    puts highlight
    puts ""
    puts "--------------------------------------------------------------------"
  end
  return "showed all the highlights!"
end

def sample
  @book_highlights.sample
end

# get to just the words
array_of_arrays_of_words = @book_highlights.map do |highlight|
  highlight.split(" ")
end

array_of_words = array_of_arrays_of_words.flatten
all_words = array_of_words.join(" ").downcase.gsub(/\W+/, ' ')

allTheWords = []
allTheWords << all_words
File.open("bagOfWords.txt", "w+") {|f| f.write allTheWords[0] }


puts ""
puts "The total number of words is #{array_of_words.length}!"
puts ""
puts "The total number of highlights is #{@book_highlights.length}"
puts ""
puts "Type sample to get a sample"
puts ""
puts "Type show_all to get all highlights"
puts ""
puts "Type all_words to see all the words as a single string"
puts ""

# TODO: follow ruby-lda documentation - prioritize mechanics over interpretation

Pry.start
